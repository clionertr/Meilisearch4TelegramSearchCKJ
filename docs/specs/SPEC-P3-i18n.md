# åŠŸèƒ½åç§°ï¼šå›½é™…åŒ– (i18n)

> **å®šä½**ï¼šWebUI é•¿æœŸæ¼”è¿› â€” æ”¯æŒä¸­/è‹±åŒè¯­ï¼ŒåŒ¹é… CJK æœç´¢å·¥å…·çš„æ ¸å¿ƒç”¨æˆ·ç¾¤

---

## 1. ä¸šåŠ¡ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰

å¼•å…¥ i18n æ¡†æ¶ï¼Œå°†æ‰€æœ‰ç¡¬ç¼–ç è‹±æ–‡ UI æ–‡æ¡ˆæå–ä¸ºèµ„æºæ–‡ä»¶ï¼Œè‡³å°‘æ”¯æŒä¸­æ–‡ (zh-CN) å’Œè‹±æ–‡ (en-US) ä¸¤ç§è¯­è¨€ï¼Œç”¨æˆ·å¯åœ¨ Settings é¡µé¢åˆ‡æ¢ã€‚

---

## 2. éªŒæ”¶æ ‡å‡†ï¼ˆGiven-When-Then æ ¼å¼ï¼‰

### AC-1ï¼šåŒè¯­åˆ‡æ¢
- **Given** Settings é¡µé¢å­˜åœ¨è¯­è¨€åˆ‡æ¢æ§ä»¶
- **When** ä» English åˆ‡æ¢åˆ° ä¸­æ–‡
- **Then** æ‰€æœ‰é¡µé¢æ ‡é¢˜ã€æŒ‰é’®ã€æç¤ºæ–‡æ¡ˆå³æ—¶åˆ‡æ¢ä¸ºä¸­æ–‡

### AC-2ï¼šè¯­è¨€æŒä¹…åŒ–
- **Given** ç”¨æˆ·é€‰æ‹©ä¸­æ–‡
- **When** åˆ·æ–°é¡µé¢
- **Then** ä»ä¸ºä¸­æ–‡

### AC-3ï¼šç»„ä»¶æ— ç¡¬ç¼–ç æ–‡æ¡ˆ
- **Given** æ‰§è¡Œ `grep -rn` æœç´¢ç¡¬ç¼–ç è‹±æ–‡å­—ç¬¦ä¸²
- **When** æ’é™¤æ³¨é‡Šå’Œå˜é‡å
- **Then** æ‰€æœ‰ç”¨æˆ·å¯è§æ–‡æ¡ˆå‡é€šè¿‡ `t('key')` è°ƒç”¨

### AC-4ï¼šç¼ºå¤±ç¿»è¯‘é™çº§
- **Given** æŸä¸ª key ç¼ºå°‘ä¸­æ–‡ç¿»è¯‘
- **When** é¡µé¢æ¸²æŸ“
- **Then** å±•ç¤ºè‹±æ–‡ fallbackï¼Œä¸å´©æºƒ

---

## 3. æŠ€æœ¯è®¾è®¡ & éåŠŸèƒ½éœ€æ±‚

### 3.1 æŠ€æœ¯é€‰å‹

æ¨è `react-i18next`ï¼ˆReact ç”Ÿæ€æ ‡å‡†æ–¹æ¡ˆï¼‰ï¼š

```bash
npm install i18next react-i18next
```

### 3.2 ç›®å½•ç»“æ„

```
src/
  i18n/
    index.ts          # i18n åˆå§‹åŒ–
    locales/
      en-US.json      # è‹±æ–‡èµ„æº
      zh-CN.json      # ä¸­æ–‡èµ„æº
```

### 3.3 èµ„æºæ–‡ä»¶ç»“æ„

```json
// en-US.json
{
  "nav": {
    "dashboard": "Dashboard",
    "search": "Search",
    "settings": "Settings"
  },
  "search": {
    "placeholder": "Search history (CJK support)...",
    "noResults": "No results found for \"{{query}}\"",
    "filters": {
      "date": "Date",
      "sender": "Sender",
      "anytime": "Anytime"
    }
  },
  "settings": {
    "title": "Settings & Management",
    "logout": "Logout",
    "logoutConfirm": "Are you sure you want to logout?"
  }
}
```

### 3.4 éåŠŸèƒ½éœ€æ±‚

- **bundle ä¼˜åŒ–**ï¼šæŒ‰è¯­è¨€æ‡’åŠ è½½èµ„æºæ–‡ä»¶
- **Fallback**ï¼šé»˜è®¤è¯­è¨€è‹±æ–‡ï¼Œç¼ºå¤± key è¿”å›è‹±æ–‡
- **æ—¶åŒº/æ—¥æœŸ**ï¼šæ—¥æœŸæ ¼å¼è·Ÿéšè¯­è¨€ï¼ˆä¸­æ–‡ç”¨ `YYYYå¹´MMæœˆDDæ—¥`ï¼Œè‹±æ–‡ç”¨ `MMM DD, YYYY`ï¼‰

---

## 4. ä»»åŠ¡æ‹†åˆ†

- [ ] **Task 1.1** â€” ğŸ“¦ i18n åŸºç¡€è®¾æ–½ (30 min)
  - å®‰è£… `i18next` + `react-i18next`
  - åˆ›å»º `src/i18n/index.ts` åˆå§‹åŒ–
  - åˆ›å»ºè‹±æ–‡èµ„æº `en-US.json` æ¡†æ¶

- [ ] **Task 1.2** â€” ğŸ”§ æå– Login/Dashboard æ–‡æ¡ˆ (40 min)
  - éå†ç»„ä»¶ï¼Œæ›¿æ¢ç¡¬ç¼–ç å­—ç¬¦ä¸²ä¸º `t('key')`
  - è¡¥å……å¯¹åº” key åˆ° `en-US.json`

- [ ] **Task 1.3** â€” ğŸ”§ æå– Search/Settings/Storage æ–‡æ¡ˆ (40 min)
  - åŒä¸Š

- [ ] **Task 1.4** â€” ğŸ”§ æå– SyncedChats/SelectChats/AIConfig æ–‡æ¡ˆ (30 min)
  - åŒä¸Š

- [ ] **Task 1.5** â€” ğŸŒ ä¸­æ–‡èµ„æºç¿»è¯‘ (30 min)
  - åˆ›å»º `zh-CN.json`
  - ç¿»è¯‘æ‰€æœ‰ key

- [ ] **Task 1.6** â€” ğŸ”§ Settings è¯­è¨€åˆ‡æ¢ UI (20 min)
  - æ–°å¢ "Language" é€‰é¡¹
  - åˆ‡æ¢åå³æ—¶ç”Ÿæ•ˆ + æŒä¹…åŒ–

- [ ] **Task 1.7** â€” âœ… éªŒè¯ (20 min)
  - ä¸­è‹±æ–‡åˆ‡æ¢å®Œæ•´
  - åˆ·æ–°æŒä¹…åŒ–
  - ç¼ºå¤± key é™çº§
  - `npm run build` é›¶é”™è¯¯

---

## 5. E2E æµ‹è¯•ç”¨ä¾‹æ¸…å•

| # | æµ‹è¯•ç”¨ä¾‹ | é¢„æœŸç»“æœ |
|---|---------|---------|
| T1 | Settings åˆ‡æ¢åˆ°ä¸­æ–‡ | æ‰€æœ‰é¡µé¢æ–‡æ¡ˆå˜ä¸ºä¸­æ–‡ |
| T2 | ä¸­æ–‡æ¨¡å¼åˆ·æ–° | ä»ä¸ºä¸­æ–‡ |
| T3 | ä¸­æ–‡æ¨¡å¼æœç´¢æ— ç»“æœ | ä¸­æ–‡ç©ºçŠ¶æ€æç¤º |
| T4 | ä¸­æ–‡æ¨¡å¼ Login é¡µ | æŒ‰é’®ã€æ ‡ç­¾ã€é”™è¯¯æ–‡æ¡ˆå‡ä¸ºä¸­æ–‡ |
| T5 | éå†æ‰€æœ‰é¡µé¢ | æ— è‹±æ–‡ç¡¬ç¼–ç æ³„æ¼ |
| T6 | `npm run build` | é›¶é”™è¯¯ |

---

## 6. å®ç°ç¬”è®° & æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰

### ADR-015ï¼šreact-i18next è€Œé formatjs/intl

- **èƒŒæ™¯**ï¼šéœ€è¦è½»é‡å¯é çš„ React i18n æ–¹æ¡ˆã€‚
- **å†³å®š**ï¼šä½¿ç”¨ `react-i18next`ã€‚
- **ç†ç”±**ï¼š
  1. React ç”Ÿæ€ä½¿ç”¨ç‡æœ€é«˜ï¼Œç¤¾åŒºèµ„æºä¸°å¯Œ
  2. æ”¯æŒ JSON èµ„æºæ–‡ä»¶ï¼Œå­¦ä¹ æˆæœ¬ä½
  3. æ”¯æŒæ‡’åŠ è½½è¯­è¨€åŒ…
  4. ä¸ TypeScript é›†æˆè‰¯å¥½
- **åæœ**ï¼šæ–°å¢ ~10KB ä¾èµ–ã€‚åç»­å¢åŠ æ—¥/éŸ©è¯­åªéœ€æ·»åŠ èµ„æºæ–‡ä»¶ã€‚
