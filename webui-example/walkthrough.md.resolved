# webui-example 当前状态评估（2026-02-24）

> 基于当前仓库代码与本地命令复核（已对齐“API 已完善”现状）

## 一句话结论

- **后端 API：已完善并进入可用态**（模块齐全、路由已注册、单元测试通过）。
- **WebUI：可运行但仅部分接入真实 API**（登录/搜索/WebSocket 已接入，其余页面仍以静态展示为主）。

---

## 本次核验范围与证据

### 代码核验

- 后端：
  - `src/tg_search/api/routes/__init__.py`
  - `src/tg_search/api/routes/*.py`
  - `src/tg_search/api/models.py`
  - `src/tg_search/api/app.py`
- 前端：
  - `webui-example/src/api/*`
  - `webui-example/src/hooks/*`
  - `webui-example/pages/*`
  - `webui-example/vite.config.ts`
  - `webui-example/tsconfig.json`
  - `webui-example/index.html`

### 命令复核（本地执行）

- `pytest -q tests/unit` -> `71 passed`
- `pytest -q tests/unit/test_api.py tests/unit/test_dashboard.py` -> `23 passed`
- `cd webui-example && npm run build` -> 构建成功（存在 `/index.css` 缺失告警）
- `cd webui-example && npx tsc --noEmit` -> 失败（`ImportMeta.env` 类型缺失）
- 集成测试默认未执行（`RUN_INTEGRATION_TESTS=true` 才启用）

---

## API 完成度评估（已完善）

### 已落地的 API 模块

- Auth：`/api/v1/auth/*`
- Search：`/api/v1/search`、`/api/v1/search/stats`
- Status：`/api/v1/status*`
- Config：`/api/v1/config*`
- Client Control：`/api/v1/client*`
- Dialog Sync：`/api/v1/dialogs*`
- Storage：`/api/v1/storage*`
- AI Config：`/api/v1/ai*`
- Dashboard：`/api/v1/dashboard*`
- WebSocket：`/api/v1/ws/status`

### 鉴权策略已细化

- `search/status/config/control/storage` 支持 `API Key 或 Bearer`
- `ai/dashboard/dialogs` 为 `Bearer-only`
- `ws/status` 在连接阶段执行 token 校验

### 工程化状态

- `api/models.py` 已覆盖各模块请求/响应模型（含 P1/P2 的 storage、ai、dashboard、dialogs）
- `api/app.py` 已配置统一异常处理、CORS、health/root、lifespan 初始化
- 单元测试通过，说明 API 基础行为与契约在当前代码下是稳定的

---

## WebUI 对接状态（部分完成）

### 页面对接总览

| 页面 | 对接状态 | 数据来源 |
|------|----------|----------|
| Login | 已对接 | `auth/send-code`, `auth/signin` |
| Search | 已对接 | `search`（分页） |
| App 级实时状态 | 已对接 | `ws/status` -> Zustand `statusStore` |
| Dashboard | 未对接 | 静态假数据 |
| Settings | 未对接 | 静态假数据 |
| Storage | 未对接 | 静态假数据 |
| SyncedChats | 未对接 | 静态假数据 |
| SelectChats | 未对接 | 静态假数据 |
| AIConfig | 未对接 | 静态假数据 |

### 已确认未完成的前端接口层

- `webui-example/src/api/` 目前仅有：
  - `auth.ts`
  - `search.ts`
  - `client.ts`
- 尚缺页面所需的 API 封装：
  - `status`、`dashboard`、`dialogs`、`storage`、`ai_config`、`control`、`config`

---

## 当前阻塞与风险（按优先级）

### P0（应优先处理）

1. `tsc` 不通过：`ImportMeta.env` 类型缺失  
   - 现状：`tsconfig.json` 仅有 `"types": ["node"]`，缺少 `vite/client`。

2. 前端联调默认路径存在歧义  
   - 现状：`VITE_API_URL` 默认回退到 `/api/v1`，`vite.config.ts` 未配置 dev proxy。

### P1（核心可用性）

1. 6 个核心业务页面仍未接入真实 API  
   - 影响：管理闭环（同步管理/存储管理/AI 配置）不可用。

2. 登录提示与后端校验不一致  
   - 现状：placeholder 为 `+1 234 567 8900`，后端要求 `^\+\d{7,15}$`。

3. JSX 语法问题仍在  
   - 现状：`SelectChats.tsx` 使用 `<img class="...">` 而非 `className`。

### P2（质量与安全）

1. `index.html` 引入 import map + CDN 依赖，与 Vite bundling 混用风险较高。  
2. `index.css` 被引用但文件不存在。  
3. `vite.config.ts` 将 `GEMINI_API_KEY` 注入前端构建产物，存在密钥暴露风险。  

---

## 与“API 已完善”的一致性说明

- 本次评估确认：**“API 已完善”成立**。  
- 目前项目主矛盾已从“后端接口缺失”转为“前端管理页尚未完成真实对接与工程收口”。

---

## 下一阶段建议（最小闭环）

1. 先修工具链阻塞：补 `vite/client`、增加 `typecheck` 脚本、消除 JSX 错误。  
2. 先打通管理最短链路：`Dashboard + SyncedChats + SelectChats` 对接 `status/dialogs/control`。  
3. 再补 `Storage + AIConfig + Settings` 对接 `storage/ai/config`。  
4. 最后处理部署质量：proxy/README、移除 import map、清理前端密钥注入。  
