{
  "version": "1.1.0",
  "generated_at": "2026-02-06T13:48:06+08:00",
  "project_name": "Meilisearch4TelegramSearchCKJ",
  "project_description": "基于 Telethon + MeiliSearch 的 Telegram 中文/日文/韩文 (CJK) 消息搜索解决方案",
  "repository": {
    "type": "git",
    "url": "https://github.com/clionertr/Meilisearch4TelegramSearchCKJ"
  },
  "statistics": {
    "total_files_estimated": 65,
    "scanned_files": 65,
    "python_files": 42,
    "typescript_files": 23,
    "config_files": 3,
    "docker_files": 2,
    "markdown_files": 8,
    "coverage_percentage": 100,
    "truncated": false
  },
  "modules": [
    {
      "name": "config",
      "path": "src/tg_search/config",
      "type": "configuration",
      "entry_points": ["settings.py"],
      "files": ["__init__.py", "settings.py"],
      "description": "环境变量配置管理，包含所有必填和可选配置项的验证与加载",
      "dependencies": ["ast", "os"],
      "key_exports": [
        "APP_ID",
        "APP_HASH",
        "TOKEN",
        "MEILI_HOST",
        "MEILI_PASS",
        "WHITE_LIST",
        "BLACK_LIST",
        "OWNER_IDS",
        "API_KEY",
        "validate_config",
        "ConfigurationError"
      ]
    },
    {
      "name": "core",
      "path": "src/tg_search/core",
      "type": "business_logic",
      "entry_points": ["bot.py", "telegram.py", "meilisearch.py"],
      "files": ["__init__.py", "bot.py", "telegram.py", "meilisearch.py", "logger.py"],
      "description": "核心业务逻辑层，包含 Bot 处理、Telegram 客户端、MeiliSearch 客户端和日志配置",
      "dependencies": [
        "telethon",
        "meilisearch",
        "coloredlogs",
        "tenacity",
        "pytz"
      ],
      "key_classes": [
        "BotHandler",
        "TelegramUserBot",
        "MeiliSearchClient"
      ],
      "interfaces": [
        {
          "class": "BotHandler",
          "commands": [
            "/start",
            "/help",
            "/start_client",
            "/stop_client",
            "/search",
            "/set_white_list2meili",
            "/set_black_list2meili",
            "/cc",
            "/about",
            "/ping"
          ]
        },
        {
          "class": "TelegramUserBot",
          "methods": [
            "start",
            "download_history",
            "cleanup",
            "register_handlers"
          ]
        },
        {
          "class": "MeiliSearchClient",
          "methods": [
            "create_index",
            "add_documents",
            "search",
            "delete_documents",
            "get_index_stats"
          ]
        }
      ],
      "error_handling": [
        "TelegramNetworkError",
        "TelegramPermissionError",
        "TelegramRateLimitError",
        "MeiliSearchConnectionError",
        "MeiliSearchTimeoutError",
        "MeiliSearchAPIError"
      ]
    },
    {
      "name": "utils",
      "path": "src/tg_search/utils",
      "type": "utilities",
      "files": [
        "__init__.py",
        "formatters.py",
        "permissions.py",
        "message_tracker.py",
        "memory.py",
        "bridge.py"
      ],
      "description": "工具函数模块，提供格式化、权限检查、消息追踪和内存监控",
      "dependencies": ["configparser", "tracemalloc"],
      "key_functions": [
        "sizeof_fmt",
        "is_allowed",
        "read_config_from_meili",
        "write_config2_meili",
        "get_latest_msg_id4_meili",
        "update_latest_msg_config4_meili",
        "get_memory_usage"
      ]
    },
    {
      "name": "api",
      "path": "src/tg_search/api",
      "type": "web_api",
      "entry_points": ["app.py"],
      "files": [
        "__init__.py",
        "app.py",
        "models.py",
        "deps.py",
        "state.py",
        "auth_store.py",
        "routes/__init__.py",
        "routes/auth.py",
        "routes/search.py",
        "routes/status.py",
        "routes/config.py",
        "routes/control.py",
        "routes/ws.py"
      ],
      "description": "FastAPI REST API 与 WebSocket 模块，提供 Web 管理界面后端",
      "dependencies": [
        "fastapi",
        "uvicorn",
        "pydantic",
        "websockets",
        "anyio"
      ],
      "key_classes": [
        "AppState",
        "AuthStore",
        "ProgressRegistry",
        "MeiliFilterBuilder"
      ],
      "interfaces": [
        {
          "prefix": "/api/v1/auth",
          "endpoints": [
            "POST /send-code",
            "POST /signin",
            "GET /me",
            "POST /logout"
          ]
        },
        {
          "prefix": "/api/v1/search",
          "endpoints": [
            "GET /",
            "GET /stats"
          ]
        },
        {
          "prefix": "/api/v1/status",
          "endpoints": [
            "GET /",
            "GET /dialogs",
            "GET /progress"
          ]
        },
        {
          "prefix": "/api/v1/config",
          "endpoints": [
            "GET /",
            "POST /whitelist",
            "POST /blacklist"
          ]
        },
        {
          "prefix": "/api/v1/client",
          "endpoints": [
            "GET /status",
            "POST /start",
            "POST /stop"
          ]
        },
        {
          "prefix": "/api/v1/ws",
          "endpoints": [
            "WS /progress"
          ]
        }
      ],
      "pydantic_models": [
        "ApiResponse",
        "ErrorResponse",
        "PaginatedResponse",
        "MessageModel",
        "SearchRequest",
        "SearchResult",
        "SystemStatus",
        "DialogInfo",
        "ConfigModel",
        "SendCodeRequest",
        "SignInRequest",
        "AuthUserInfo"
      ]
    },
    {
      "name": "tests",
      "path": "tests",
      "type": "testing",
      "files": [
        "conftest.py",
        "test_meilisearch_handler.py",
        "test_utils.py",
        "test_configparser.py",
        "test_logger.py",
        "test_tg_client.py",
        "test_meilisearch.py",
        "test_api.py",
        "test_api_integration.py",
        "get_session_file.py",
        "get_str_session.py",
        "delete_all_contain_keyword.py"
      ],
      "description": "测试套件，包含单元测试、API测试、集成测试和测试工具脚本",
      "test_framework": "pytest",
      "test_coverage": [
        "MeiliSearchClient CRUD operations",
        "Exception handling",
        "Permissions",
        "Formatters",
        "Configuration validation",
        "FastAPI endpoints",
        "Pydantic models",
        "ProgressRegistry"
      ],
      "fixtures": [
        "mock_meilisearch_client",
        "mock_index",
        "sample_documents",
        "mock_logger",
        "mock_telegram_client",
        "mock_app_state",
        "test_client"
      ]
    },
    {
      "name": "webui-example",
      "path": "webui-example",
      "type": "frontend",
      "entry_points": ["index.tsx", "App.tsx"],
      "files": [
        "index.tsx",
        "App.tsx",
        "types.ts",
        "vite.config.ts",
        "package.json",
        "components/BottomNav.tsx",
        "components/DonutChart.tsx",
        "pages/Login.tsx",
        "pages/Dashboard.tsx",
        "pages/Search.tsx",
        "pages/Settings.tsx",
        "pages/Storage.tsx",
        "pages/SyncedChats.tsx",
        "pages/SelectChats.tsx",
        "pages/AIConfig.tsx",
        "services/geminiService.ts",
        "src/api/client.ts",
        "src/api/auth.ts",
        "src/api/search.ts",
        "src/store/authStore.ts",
        "src/store/statusStore.ts",
        "src/hooks/useAuth.ts",
        "src/hooks/useSearch.ts",
        "src/hooks/useWebSocket.ts",
        "src/components/common/ProtectedRoute.tsx",
        "src/components/common/Highlight.tsx"
      ],
      "description": "React + TypeScript 前端界面，提供移动优先的 Telegram 消息搜索体验",
      "dependencies": [
        "react",
        "react-dom",
        "react-router-dom",
        "@tanstack/react-query",
        "zustand",
        "axios",
        "react-use-websocket",
        "@google/genai",
        "vite"
      ],
      "key_components": [
        "App",
        "ProtectedRoute",
        "BottomNav",
        "Highlight"
      ],
      "pages": [
        "Login",
        "Dashboard",
        "Search",
        "Settings",
        "Storage",
        "SyncedChats",
        "SelectChats",
        "AIConfig"
      ],
      "stores": [
        "authStore (zustand + persist)",
        "statusStore (zustand)"
      ],
      "api_modules": [
        "client.ts (axios instance + interceptors)",
        "auth.ts (sendCode, signIn, me, logout)",
        "search.ts (search)"
      ],
      "hooks": [
        "useAuth",
        "useSearch",
        "useWebSocket (useStatusWebSocket)"
      ]
    }
  ],
  "entry_points": {
    "cli": "tg_search.__main__:main",
    "module": "python -m tg_search",
    "api": "tg_search.api.app:app",
    "flask_app": "tg_search.app:app"
  },
  "run_modes": {
    "all": "python -m tg_search (default: API + Bot)",
    "api-only": "python -m tg_search --mode api-only",
    "bot-only": "python -m tg_search --mode bot-only"
  },
  "data_models": {
    "message_schema": {
      "id": "string (format: chat_id-msg_id or chat_id-msg_id-edit_ts)",
      "chat": "object (id, type, title, username)",
      "date": "string (ISO-8601 timestamp)",
      "text": "string (message content or caption)",
      "from_user": "object (id, username)",
      "reactions": "object (emoji: count) or null",
      "reactions_scores": "float or null",
      "text_len": "integer"
    },
    "config_schema": {
      "id": "integer (always 0 for singleton)",
      "WHITE_LIST": "array of integers",
      "BLACK_LIST": "array of integers",
      "chat_id": "integer (latest message id per chat)"
    }
  },
  "ignored_patterns": [
    "__pycache__/**",
    "*.pyc",
    "*.pyo",
    "*.pyd",
    ".venv/**",
    "venv/**",
    "build/**",
    "dist/**",
    "*.egg-info/**",
    ".pytest_cache/**",
    "htmlcov/**",
    ".coverage",
    ".vscode/**",
    ".idea/**",
    ".env",
    "*.log",
    "session/*.session",
    "session/*.session-journal",
    ".ace-tool/**",
    "webui-example/node_modules/**"
  ],
  "gaps": [],
  "next_steps": []
}
